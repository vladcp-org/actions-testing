name: Run tests

on: 
  workflow_dispatch:
  workflow_run:
    workflows: ["Deploy"]
    types: 
      - completed
  # pull_request:

jobs:
  tests:
    name: "Run dummy tests"
    if: ${{ github.event_name == 'workflow_run' && github.event.workflow_run.conclusion == 'success' || github.event_name == 'workflow_dispatch'}}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Print hello
        run: >
          echo "Hello World!"
      - name: Determine branch name
        run: |
          if [ "${{github.event_name}}" == "workflow_run" ]; then
            echo "BRANCH_NAME=${{github.event.workflow_run.head_branch}}" >> $GITHUB_ENV
          elif [ "${{github.event_name}}" == "workflow_dispatch" ]; then
            echo "BRANCH_NAME=${{github.ref_name || github.head_ref}}" >> $GITHUB_ENV
          fi
      - name: Print event branch, hopefully
        run: >
          echo "BRANCH NAME is ${{ env.BRANCH_NAME }}"

      - name: Recognize sha ref
        id: sharef
        run: |
          if [ "$EVENT" == 'pull_request' ]
          then
            echo "sha=${{github.event.pull_request.head.sha}}" >> $GITHUB_OUTPUT
          elif [ "$EVENT" == 'workflow_run' ]
          then
            echo "sha=${{github.event.workflow_run.head_sha}})" >> $GITHUB_OUTPUT
          else
            echo "sha=$GITHUB_SHA" >> $GITHUB_OUTPUT
          fi
        env:
          EVENT: ${{ github.event_name }}
          REF: ${{ github.ref }}

      - name: Commit Action Status
        uses: LouisBrunner/checks-action@v1.1.1
        with:
          sha: ${{ steps.sharef.outputs.sha }}
          token: ${{ secrets.GITHUB_TOKEN }}